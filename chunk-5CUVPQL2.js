import{i as z,j as N,k as A}from"./chunk-D5MXNW3W.js";import{a as Q}from"./chunk-WU3VUF36.js";import{e as D}from"./chunk-G4MBMDPR.js";import{a as F,b as v}from"./chunk-OC5M4CSB.js";import{Cb as g,Fa as m,Ga as l,Gb as u,Pb as y,Ub as d,Vb as c,Wb as _,_b as O,bc as h,h as f,hc as C,jc as j,kc as S,lb as p,ua as b,uc as w}from"./chunk-7MXG77XU.js";var I=class extends Q{constructor(t,o){super(t),this.myApi=t,this.route=o,this.commonObjs={},this.data=[],this.selectData=[],this.searchQuery={pageNum:1,pageSize:50,orderBy:null,asc:!0,total:0},this.route.queryParams.subscribe(e=>{this.menuCode=e.menuCode,this.menuName=e.menuName,this.getBtns()}),this.route.params.subscribe(e=>{this.formId=e.formId,this.parse()});let r=this;this.getInstanceMethods(this).forEach(e=>{let n=r[e];typeof n=="function"?(this.commonObjs[e]=n.bind(r),Object.defineProperty(r,e,{get:()=>this.commonObjs[e],set:i=>{this.commonObjs[e]=i.bind(r)},configurable:!0,enumerable:!0})):(this.commonObjs[e]=n,Object.defineProperty(r,e,{get:()=>this.commonObjs[e],set:i=>{this.commonObjs[e]=i},configurable:!0,enumerable:!0}))})}getInstanceMethods(t){let o=[],r=t;do o.push(...Object.getOwnPropertyNames(r));while(r=Object.getPrototypeOf(r));o=[...new Set(o)];let e=["constructor","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","toLocaleString","toString","valueOf","commonObjs","getInstanceMethods"];return o.filter(n=>e.indexOf(n)===-1&&!n.startsWith("__"))}btnClick(t){t==="refresh"?this.refresh():t==="export"?this.export():t==="exportAll"&&this.exportAll()}refresh(){for(let o of this.formCols)if(o.required&&!o.value){this.myApi.warning(`${o.label}\u4E0D\u80FD\u4E3A\u7A7A`);return}let t=this.getFormColsData();t.pageNum=this.searchQuery.pageNum,t.pageSize=this.searchQuery.pageSize,t.orderBy=this.searchQuery.orderBy,t.asc=this.searchQuery.asc,this.myApi.get(this.serverUrl,t).then(o=>{(o.code===200||o.data)&&(this.searchQuery.total=o.data.total-0,this.data=o.data.records)})}queryFun(t){this.searchQuery.pageNum=t.pageNum,this.searchQuery.pageSize=t.pageSize,this.searchQuery.orderBy=t.orderBy,this.searchQuery.asc=t.asc,this.refresh()}gotoSetForm(t){this.path&&this.myApi.navigateById(this.path,t.row.id)}getSelected(t){this.selectData=t}formation(t,o){if(t.type==="select"||t.type==="radio"){let r=t.options?.find(e=>e.value===o);return r?r.label:o}return o}export(){if(this.selectData.length===0){this.myApi.warning("\u8BF7\u9009\u62E9\u8981\u5BFC\u51FA\u7684\u6570\u636E");return}let t=this.selectData.map((o,r)=>{let e={};return this.formGrids.forEach(n=>{n.code==="_Index"?e[n.label??n.code]=r+1:e[n.label??n.code]=this.formation(n,o[n.code])}),e});this.myApi.exportToExcel(t,this.menuName)}exportAll(){return f(this,null,function*(){for(let e of this.formCols)if(e.required&&!e.value){this.myApi.warning(`${e.label}\u4E0D\u80FD\u4E3A\u7A7A`);return}let t=this.getFormColsData();t.pageNum=1,t.pageSize=5e4;let r=(yield this.myApi.get(this.serverUrl,t)).data.records.map((e,n)=>{let i={};return this.formGrids.forEach(s=>{s.code==="_Index"?i[s.label??s.code]=n+1:i[s.label??s.code]=this.formation(s,e[s.code])}),i});this.myApi.exportToExcel(r,this.menuName)})}};function V(a,t){a&1&&(d(0,"div",5),_(1,"nz-spin",6),c())}var $=(()=>{class a{constructor(){this.commonObjs={}}ngAfterViewInit(){}static{this.\u0275fac=function(r){return new(r||a)}}static{this.\u0275cmp=b({type:a,selectors:[["app-form-report"]],contentQueries:function(r,e,n){if(r&1&&C(n,D,4),r&2){let i;j(i=S())&&(e.templates=i)}},inputs:{commonObjs:"commonObjs"},standalone:!0,features:[w],decls:6,vars:9,consts:[["forms",""],[1,"body-content"],[3,"clc","btns"],[3,"enter","form-cols","disabled"],[1,"app-grids",3,"queryFun","selectData","colDblClick","templates","data","form-grids","search-query","isSelected"],[1,"container"],["nzSimple","","nzSize","large",2,"margin-top","20%"]],template:function(r,e){if(r&1){let n=O();d(0,"div",1)(1,"app-btns",2),h("clc",function(s){return m(n),l(e.commonObjs.btnClick(s))}),c(),d(2,"app-forms",3,0),h("enter",function(){return m(n),l(e.commonObjs.refresh())}),c(),d(4,"app-grids",4),h("queryFun",function(s){return m(n),l(e.commonObjs.queryFun(s))})("selectData",function(s){return m(n),l(e.commonObjs.getSelected(s))})("colDblClick",function(s){return m(n),l(e.commonObjs.gotoSetForm(s))}),c(),g(5,V,2,0,"div",5),c()}r&2&&(p(),u("btns",e.commonObjs.btns),p(),u("form-cols",e.commonObjs.formCols)("disabled",e.commonObjs.disabled),p(2),u("templates",e.templates)("data",e.commonObjs.data)("form-grids",e.commonObjs.formGrids)("search-query",e.commonObjs.searchQuery)("isSelected",e.commonObjs.isSelected),p(),y(e.commonObjs.isInit?-1:5))},dependencies:[z,N,A,v,F],styles:[".body-content[_ngcontent-%COMP%]{height:100%;display:flex;flex-direction:column}.body-content[_ngcontent-%COMP%]   .app-grids[_ngcontent-%COMP%]{margin-top:10px;flex:1}.container[_ngcontent-%COMP%]{position:absolute;top:0;left:0;z-index:999;text-align:center;background:#0003;width:100%;height:100%}"]})}}return a})();export{I as a,$ as b};
