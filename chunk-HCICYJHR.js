import{b as F}from"./chunk-KSRDVEKR.js";import"./chunk-D5MXNW3W.js";import"./chunk-PE6PQG5P.js";import{d as T}from"./chunk-G4MBMDPR.js";import{i as P,s as S}from"./chunk-C6KGLNM7.js";import{d as O,e as b}from"./chunk-RXULLGBC.js";import"./chunk-5MKA6IQ4.js";import"./chunk-GXHJ6PF2.js";import"./chunk-OC5M4CSB.js";import{C as _,G as v,N as w,cc as K,fc as R,hc as D,ta as A}from"./chunk-TXLPFZIX.js";import{Fa as m,Ga as a,Gb as c,Ub as s,Vb as o,Wb as C,_b as z,bc as g,lb as p,mb as u,mc as h,qc as k,rc as I,sc as N,ua as y,uc as M}from"./chunk-7MXG77XU.js";var ie=(()=>{class d{constructor(t,n){this.myApi=t,this.modal=n,this.currentRoleId=null,this.menusNode=[],this.interfaceNode=[],this.defaultCheckedKeys=[],this.defaultCheckedKeysInterface=[],this.rolesModel=[]}ngOnInit(){this.myApi.get("userrole/allroles").then(t=>{t.code===200&&(this.rolesModel=t.data.map(n=>({label:n.name,value:n.id})))}),this.myApi.get("rolemenu/menutree?type=1").then(t=>{t.code===200&&(this.menusNode=t.data)}),this.myApi.get("rolemenu/interfacetree").then(t=>{t.code===200&&(this.interfaceNode=t.data)})}onRoleChange(){this.defaultCheckedKeys=[],this.currentRoleId&&(this.myApi.get(`rolemenu/menus?roleId=${this.currentRoleId}`).then(t=>{if(t.code===200){let n=t.data.map(e=>e.menuId);this.setChecked(this.menusNode,n),this.defaultCheckedKeys=[...this.defaultCheckedKeys]}}),this.myApi.get(`rolemenu/interfaces?roleId=${this.currentRoleId}`).then(t=>{t.code===200&&(this.defaultCheckedKeysInterface=this.setCheckedInterface(this.interfaceNode,t.data))}))}save(){if(!this.currentRoleId){this.myApi.warning("\u8BF7\u5148\u9009\u62E9\u89D2\u8272");return}this.myApi.post(`rolemenu/rolemenu?roleId=${this.currentRoleId}`,this.getCheckBtn(this.menusNode)).then(t=>{t.code===200&&(this.defaultCheckedKeys=[],this.myApi.post(`rolemenu/roleinterface?roleId=${this.currentRoleId}`,this.getCheckInterface(this.interfaceNode)).then(n=>{n.code===200&&(this.myApi.success("\u4FDD\u5B58\u6210\u529F"),this.currentRoleId=null,this.defaultCheckedKeysInterface=[])}))})}getCheckBtn(t){let n=[];for(let e of t)e.isLeaf&&e.checked&&n.push(e.key),!e.isLeaf&&e.children&&e.children.length>0&&n.push(...this.getCheckBtn(e.children));return n}getCheckInterface(t){let n=[];for(let e of t)for(let r of e.children??[])for(let i of r.children??[])i.checked&&n.push({url:i.title.substring(0,i.title.lastIndexOf("-")),method:i.title.substring(i.title.lastIndexOf("-")+1),jar:e.title,controller:r.title,roleId:this.currentRoleId});return n}setChecked(t,n){for(let e of t)n.find(r=>r===e.key)&&this.defaultCheckedKeys.push(e.key),!e.isLeaf&&e.children&&e.children.length>0&&this.setChecked(e.children,n)}setCheckedInterface(t,n){let e=n.map(i=>`${i.url}-${i.method}`),r=[];for(let i of t)for(let l of i.children??[])for(let f of l.children??[])f.title&&e.find(x=>x===f.title)&&r.push(f.key);return r}static{this.\u0275fac=function(n){return new(n||d)(u(D),u(K))}}static{this.\u0275cmp=y({type:d,selectors:[["app-user"]],standalone:!0,features:[M],decls:14,vars:6,consts:[["nzTreeComponent",""],["interfaceTree",""],["nzAllowClear","","nzShowSearch","","nzPlaceHolder","\u9009\u62E9\u89D2\u8272",1,"role-select",3,"ngModelChange","ngModel","nzOptions"],["nz-button","","nzType","primary",2,"margin-left","35px",3,"click"],[1,"role-main"],["nzCheckable","",1,"tree",3,"nzData","nzCheckedKeys"]],template:function(n,e){if(n&1){let r=z();s(0,"nz-select",2),N("ngModelChange",function(l){return m(r),I(e.currentRoleId,l)||(e.currentRoleId=l),a(l)}),g("ngModelChange",function(){return m(r),a(e.onRoleChange())}),o(),s(1,"button",3),g("click",function(){return m(r),a(e.save())}),h(2,"\u4FDD\u5B58"),o(),s(3,"div",4)(4,"div")(5,"span"),h(6,"\u83DC\u5355\u6743\u9650"),o(),C(7,"nz-tree",5,0),o(),s(9,"div")(10,"span"),h(11,"\u63A5\u53E3\u6743\u9650"),o(),C(12,"nz-tree",5,1),o()()}n&2&&(k("ngModel",e.currentRoleId),c("nzOptions",e.rolesModel),p(7),c("nzData",e.menusNode)("nzCheckedKeys",e.defaultCheckedKeys),p(5),c("nzData",e.interfaceNode)("nzCheckedKeys",e.defaultCheckedKeysInterface))},dependencies:[R,w,_,v,P,T,b,O,S,F,A],styles:[".role-select[_ngcontent-%COMP%]{width:200px;margin-top:20px}.tree[_ngcontent-%COMP%]{margin-top:20px}.role-main[_ngcontent-%COMP%]{display:flex;flex-direction:row;gap:120px;align-items:flex-start;margin-top:20px}.role-main[_ngcontent-%COMP%] > div[_ngcontent-%COMP%] > span[_ngcontent-%COMP%]{margin-left:10px}"]})}}return d})();export{ie as PermissionComponent};
