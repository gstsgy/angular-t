import{b as Pt}from"./chunk-KSRDVEKR.js";import{a as Vt}from"./chunk-MC5KT5GL.js";import{a as Rt,b as $t}from"./chunk-QKE4NJ3N.js";import{a as jt,b as kt}from"./chunk-5CUVPQL2.js";import"./chunk-D5MXNW3W.js";import"./chunk-PE6PQG5P.js";import"./chunk-WU3VUF36.js";import"./chunk-G4MBMDPR.js";import"./chunk-C6KGLNM7.js";import"./chunk-RXULLGBC.js";import"./chunk-5MKA6IQ4.js";import{a as bt,b as Mt,e as Ot,f as qt,g as xt,h as Ft}from"./chunk-GXHJ6PF2.js";import{a as Lt}from"./chunk-OC5M4CSB.js";import{C as ft,D as gt,F as Ct,G as zt,H as vt,Hb as Dt,N as It,Q as Et,R as N,cc as Nt,fa as yt,fc as Tt,hc as At,ia as wt,ka as St,o as ht,ta as _t,w as pt,z as ut}from"./chunk-TXLPFZIX.js";import{A as O,B as k,Cb as g,Dc as dt,Fa as u,G as P,Ga as f,Gb as C,K as W,Ma as J,Na as K,P as q,Pa as tt,Pb as x,Qc as D,U as Z,Ub as r,Vb as a,Wb as I,Zc as ct,_b as ot,a as s,bc as nt,dc as c,ea as h,ga as B,ic as st,ja as Q,jc as rt,jd as mt,ka as U,kc as at,la as G,lb as d,mb as l,mc as m,n as b,o as M,oc as F,p as R,pa as H,qa as X,qc as E,rc as y,sc as w,tc as lt,ua as v,uc as S,v as $,va as Y,xb as et,zb as it}from"./chunk-7MXG77XU.js";function Bt(i,p){i&1&&(r(0,"div",0),I(1,"nz-spin"),a())}function Qt(i,p){}function Ut(i,p){if(i&1&&(r(0,"div",1),g(1,Qt,0,0,"ng-template",2),a()),i&2){let t=c();d(),C("ngTemplateOutlet",t.nzToolkit)}}var T="codeEditor";function A(i){return(...p)=>{i&&i(...p)}}var L=new R(1),z="unload",Gt=(()=>{class i{constructor(t){this.nzConfigService=t,this.document=X(ct),this.firstEditorInitialized=!1,this.option={},this.option$=new M(this.option);let e=this.nzConfigService.getConfigForComponent(T);this.config=s({},e),this.config.monacoEnvironment&&(window.MonacoEnvironment=s({},this.config.monacoEnvironment)),this.option=this.config.defaultEditorOption||{},this.subscription=this.nzConfigService.getConfigChangeEventForComponent(T).subscribe(()=>{let o=this.nzConfigService.getConfigForComponent(T);o&&this._updateDefaultOption(o.defaultEditorOption)})}ngOnDestroy(){this.subscription.unsubscribe(),this.subscription=null}_updateDefaultOption(t){this.option=s(s({},this.option),t),this.option$.next(this.option),"theme"in t&&t.theme&&monaco.editor.setTheme(t.theme)}requestToInit(){return z==="LOADED"?(this.onInit(),$(this.getLatestOption())):(z==="unload"&&(this.config.useStaticLoading&&typeof monaco>"u"?N("You choose to use static loading but it seems that you forget to config webpack plugin correctly. Please refer to our official websitefor more details about static loading."):this.loadMonacoScript()),L.pipe(B(()=>this.onInit()),O(()=>this.getLatestOption())))}loadMonacoScript(){if(this.config.useStaticLoading){Promise.resolve().then(()=>this.onLoad());return}if(z==="loading")return;z="loading";let t=this.config.assetsRoot,e=t?`${t}/vs`:"assets/vs",o=window,n=this.document.createElement("script");n.type="text/javascript",n.src=`${e}/loader.js`;let _=()=>{j(),o.require.config(s({paths:{vs:e}},this.config.extraConfig)),o.require(["vs/editor/editor.main"],()=>{this.onLoad()})},V=()=>{throw j(),new Error(`${Et} cannot load assets of monaco editor from source "${e}".`)},j=()=>{n.removeEventListener("load",_),n.removeEventListener("error",V),this.document.documentElement.removeChild(n)};n.addEventListener("load",_),n.addEventListener("error",V),this.document.documentElement.appendChild(n)}onLoad(){z="LOADED",L.next(!0),L.complete(),A(this.config.onLoad)()}onInit(){this.firstEditorInitialized||(this.firstEditorInitialized=!0,A(this.config.onFirstEditorInit)()),A(this.config.onInit)()}getLatestOption(){return s({},this.option)}static{this.\u0275fac=function(e){return new(e||i)(H(wt))}}static{this.\u0275prov=U({token:i,factory:i.\u0275fac,providedIn:"root"})}}return i})(),Ht=(()=>{class i{set nzEditorOption(t){this.editorOption$.next(t)}constructor(t,e,o,n){this.nzCodeEditorService=t,this.ngZone=e,this.platform=n,this.nzEditorMode="normal",this.nzOriginalText="",this.nzLoading=!1,this.nzFullControl=!1,this.nzEditorInitialized=new J,this.editorOptionCached={},this.destroy$=new b,this.resize$=new b,this.editorOption$=new M({}),this.editorInstance=null,this.value="",this.modelSet=!1,this.onDidChangeContentDisposable=null,this.onChange=_=>{},this.onTouch=()=>{},this.el=o.nativeElement,this.el.classList.add("ant-code-editor")}ngAfterViewInit(){this.platform.isBrowser&&this.nzCodeEditorService.requestToInit().pipe(h(this.destroy$)).subscribe(t=>this.setup(t))}ngOnDestroy(){this.onDidChangeContentDisposable&&(this.onDidChangeContentDisposable.dispose(),this.onDidChangeContentDisposable=null),this.editorInstance&&(this.editorInstance.dispose(),this.editorInstance=null),this.destroy$.next(),this.destroy$.complete()}writeValue(t){this.value=t,this.setValue()}registerOnChange(t){this.onChange=t}registerOnTouched(t){this.onTouch=t}layout(){this.resize$.next()}setup(t){this.ngZone.runOutsideAngular(()=>yt().pipe(h(this.destroy$)).subscribe(()=>{this.editorOptionCached=t,this.registerOptionChanges(),this.initMonacoEditorInstance(),this.registerResizeChange(),this.setValue(),this.nzFullControl||this.setValueEmitter(),this.nzEditorInitialized.observers.length&&this.ngZone.run(()=>this.nzEditorInitialized.emit(this.editorInstance))}))}registerOptionChanges(){k([this.editorOption$,this.nzCodeEditorService.option$]).pipe(h(this.destroy$)).subscribe(([t,e])=>{this.editorOptionCached=s(s(s({},this.editorOptionCached),e),t),this.updateOptionToMonaco()})}initMonacoEditorInstance(){this.ngZone.runOutsideAngular(()=>{this.editorInstance=this.nzEditorMode==="normal"?monaco.editor.create(this.el,s({},this.editorOptionCached)):monaco.editor.createDiffEditor(this.el,s({},this.editorOptionCached))})}registerResizeChange(){this.ngZone.runOutsideAngular(()=>{P(window,"resize").pipe(q(300),h(this.destroy$)).subscribe(()=>{this.layout()}),this.resize$.pipe(h(this.destroy$),W(()=>!!this.editorInstance),O(()=>({width:this.el.clientWidth,height:this.el.clientHeight})),Z((t,e)=>t.width===e.width&&t.height===e.height),q(50)).subscribe(()=>{this.editorInstance.layout()})})}setValue(){if(this.editorInstance){if(this.nzFullControl&&this.value){N("should not set value when you are using full control mode! It would result in ambiguous data flow!");return}if(this.nzEditorMode==="normal")if(this.modelSet){let t=this.editorInstance.getModel();this.preservePositionAndSelections(()=>t.setValue(this.value))}else this.editorInstance.setModel(monaco.editor.createModel(this.value,this.editorOptionCached.language)),this.modelSet=!0;else if(this.modelSet){let t=this.editorInstance.getModel();this.preservePositionAndSelections(()=>{t.modified.setValue(this.value),t.original.setValue(this.nzOriginalText)})}else{let t=this.editorOptionCached.language;this.editorInstance.setModel({original:monaco.editor.createModel(this.nzOriginalText,t),modified:monaco.editor.createModel(this.value,t)}),this.modelSet=!0}}}preservePositionAndSelections(t){if(!this.editorInstance){t();return}let e=this.editorInstance.getPosition(),o=this.editorInstance.getSelections();t(),e&&this.editorInstance.setPosition(e),o&&this.editorInstance.setSelections(o)}setValueEmitter(){let t=this.nzEditorMode==="normal"?this.editorInstance.getModel():this.editorInstance.getModel().modified;this.onDidChangeContentDisposable=t.onDidChangeContent(()=>{this.emitValue(t.getValue())})}emitValue(t){this.value!==t&&(this.value=t,this.ngZone.run(()=>{this.onChange(t)}))}updateOptionToMonaco(){this.editorInstance&&this.editorInstance.updateOptions(s({},this.editorOptionCached))}static{this.\u0275fac=function(e){return new(e||i)(l(Gt),l(K),l(tt),l(St))}}static{this.\u0275cmp=v({type:i,selectors:[["nz-code-editor"]],inputs:{nzEditorMode:"nzEditorMode",nzOriginalText:"nzOriginalText",nzLoading:[2,"nzLoading","nzLoading",D],nzFullControl:[2,"nzFullControl","nzFullControl",D],nzToolkit:"nzToolkit",nzEditorOption:"nzEditorOption"},outputs:{nzEditorInitialized:"nzEditorInitialized"},exportAs:["nzCodeEditor"],standalone:!0,features:[lt([{provide:pt,useExisting:Q(()=>i),multi:!0}]),it,S],decls:2,vars:2,consts:[[1,"ant-code-editor-loading"],[1,"ant-code-editor-toolkit"],[3,"ngTemplateOutlet"]],template:function(e,o){e&1&&g(0,Bt,2,0,"div",0)(1,Ut,2,1,"div",1),e&2&&(x(o.nzLoading?0:-1),d(),x(o.nzToolkit?1:-1))},dependencies:[Lt,mt],encapsulation:2,changeDetection:0})}}return i})(),Wt=(()=>{class i{static{this.\u0275fac=function(e){return new(e||i)}}static{this.\u0275mod=Y({type:i})}static{this.\u0275inj=G({imports:[Ht]})}}return i})();var Xt=["sqlForm"];function Yt(i,p){if(i&1){let t=ot();r(0,"form",2)(1,"nz-form-item")(2,"nz-form-label"),m(3,"\u7F16\u53F7"),a(),r(4,"nz-form-control")(5,"input",3),w("ngModelChange",function(o){u(t);let n=c();return y(n.sqlItem.id,o)||(n.sqlItem.id=o),f(o)}),a()()(),r(6,"nz-form-item")(7,"nz-form-label"),m(8,"\u540D\u79F0"),a(),r(9,"nz-form-control")(10,"input",4),w("ngModelChange",function(o){u(t);let n=c();return y(n.sqlItem.name,o)||(n.sqlItem.name=o),f(o)}),a()()(),r(11,"nz-form-item")(12,"button",5),nt("click",function(){u(t);let o=c();return f(o.save())}),m(13,"\u4FDD\u5B58"),a()(),r(14,"nz-form-item")(15,"nz-form-label"),m(16,"\u540E\u53F0\u63A5\u53E3"),a(),r(17,"nz-form-control")(18,"span"),m(19),a(),r(20,"span"),m(21),a()()()(),r(22,"app-ace-editor",6),w("contentChange",function(o){u(t);let n=c();return y(n.sqlItem.sql,o)||(n.sqlItem.sql=o),f(o)}),a()}if(i&2){let t=c();C("nzLayout","inline"),d(5),E("ngModel",t.sqlItem.id),d(5),E("ngModel",t.sqlItem.name),d(9),F(" formsql/data/",t.sqlItem.id,""),d(2),F(" formsql/page/",t.sqlItem.id,""),d(),E("content",t.sqlItem.sql)}}var je=(()=>{class i extends jt{constructor(t,e,o,n){super(t,e),this.myApi=t,this.route=e,this.drawerService=o,this.modal=n,this.sqlItem={id:null,name:null,sql:""}}btnClick(t){if(t==="add"){this.add();return}else if(t==="delete"){this.delete();return}super.btnClick(t)}add(){this.sqlItem={id:null,name:null,sql:""},this.drawerRef=this.drawerService.create({nzTitle:"SQL\u7F16\u8F91",nzWidth:"80%",nzContent:this.sqlForm})}gotoSetForm(t){this.sqlItem=t.row,this.drawerRef=this.drawerService.create({nzTitle:"SQL\u7F16\u8F91",nzWidth:"80%",nzContent:this.sqlForm})}delete(){if(this.selectData.length===0){this.myApi.warning("\u8BF7\u52FE\u9009\u6570\u636E");return}this.myApi.delete("formsql/item",this.selectData).then(t=>{t.code===200&&(this.myApi.success("\u5220\u9664\u6210\u529F"),this.refresh())})}save(){this.sqlItem.id?this.myApi.put("formsql/item",this.sqlItem).then(t=>{t.code===200&&(this.myApi.success("\u4FDD\u5B58\u6210\u529F"),this.drawerRef?.close(),this.refresh())}):this.myApi.post("formsql/item",this.sqlItem).then(t=>{t.code===200&&(this.myApi.success("\u4FDD\u5B58\u6210\u529F"),this.drawerRef?.close(),this.refresh())})}publish(){this.sqlItem.id?this.myApi.post("formsql/publish",this.sqlItem).then(t=>{t.code===200&&(this.myApi.success("\u53D1\u5E03\u6210\u529F"),this.drawerRef?.close(),this.refresh())}):this.myApi.warning("\u8BF7\u5148\u4FDD\u5B58")}unPublish(){this.sqlItem.id?this.myApi.post("formsql/un-publish",this.sqlItem).then(t=>{t.code===200&&(this.myApi.success("\u53D6\u6D88\u53D1\u5E03\u6210\u529F"),this.drawerRef?.close(),this.refresh())}):this.myApi.warning("\u8BF7\u5148\u4FDD\u5B58")}static{this.\u0275fac=function(e){return new(e||i)(l(At),l(ht),l(Rt),l(Nt))}}static{this.\u0275cmp=v({type:i,selectors:[["app-form-sql"]],viewQuery:function(e,o){if(e&1&&st(Xt,5),e&2){let n;rt(n=at())&&(o.sqlForm=n.first)}},standalone:!0,features:[et,S],decls:3,vars:1,consts:[["sqlForm",""],[2,"height","100%",3,"commonObjs"],["nz-form","",3,"nzLayout"],["nz-input","","name","id","disabled","",3,"ngModelChange","ngModel"],["nz-input","","name","name",3,"ngModelChange","ngModel"],["nz-button","","nzType","primary",3,"click"],[1,"editor",3,"contentChange","content"]],template:function(e,o){e&1&&(I(0,"app-form-report",1),g(1,Yt,23,6,"ng-template",null,0,dt)),e&2&&C("commonObjs",o.commonObjs)},dependencies:[Tt,kt,It,vt,ut,ft,gt,zt,Ct,Mt,xt,qt,Ot,Ft,Dt,bt,Pt,Wt,$t,_t,Vt],styles:[".editor[_ngcontent-%COMP%]{margin-top:5px;display:block;height:calc(100% - 45px)}"]})}}return i})();export{je as FormSqlComponent};
