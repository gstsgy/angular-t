import{i as _,j as E}from"./chunk-D5MXNW3W.js";import"./chunk-PE6PQG5P.js";import{a as S}from"./chunk-WU3VUF36.js";import"./chunk-G4MBMDPR.js";import"./chunk-C6KGLNM7.js";import"./chunk-RXULLGBC.js";import"./chunk-5MKA6IQ4.js";import"./chunk-GXHJ6PF2.js";import{a as F,b as g}from"./chunk-OC5M4CSB.js";import{hc as A,o as C}from"./chunk-TXLPFZIX.js";import{Cb as u,Gb as m,Pb as b,Ub as l,Vb as h,Wb as p,bc as v,h as n,lb as a,mb as r,ua as c,uc as y,xb as f}from"./chunk-7MXG77XU.js";var d=class extends S{constructor(e,t){super(e),this.myApi=e,this.route=t,this.id="",this.updateObj={},this.route.queryParams.subscribe(i=>n(this,null,function*(){this.id=i.id,this.menuCode=i.menuCode,this.menuName=i.menuName,yield this.getBtns(),this.undo()})),this.route.params.subscribe(i=>n(this,null,function*(){this.formId=i.formId,yield this.parse(),this.disabled=!0}))}btnClick(e){e==="add"?this.add():e==="undo"?this.undo():e==="save"?this.save():e==="query"?this.query():e==="edit"?this.edit():e==="delete"&&this.delete()}add(){this.id="",this.restForm(),this.disabled=!1,this.btns.forEach(e=>{e.disable=e.code==="add"||e.code==="edit"||e.code==="delete"})}undo(){if(!this.isInit){setTimeout(()=>this.undo(),200);return}this.disabled=!0,this.id?this.myApi.get(this.serverUrl,{id:this.id}).then(e=>{e.code===200&&(this.updateObj=e.data,this.formCols.forEach(t=>{e.data[t.code]&&(t.type==="date"?t.value=this.myApi.dateParse(e.data[t.code]):t.type==="datetime"?t.value=this.myApi.datetimeParse(e.data[t.code]):t.type==="time"?t.value=this.myApi.timeParse(e.data[t.code]):t.value=e.data[t.code])}),this.btns.forEach(t=>{t.disable=t.code==="undo"||t.code==="save"||t.code==="delete"}))}):(this.restForm(),this.btns.forEach(e=>{e.disable=e.code==="undo"||e.code==="save"||e.code==="edit"||e.code==="delete"}))}save(){for(let t of this.formCols)if(t.required&&!t.value){this.myApi.warning(`${t.label}\u4E0D\u80FD\u4E3A\u7A7A`);return}let e=this.getFormColsData();if(this.id){for(let t in e)this.updateObj[t]=e[t];this.myApi.put(this.serverUrl,this.updateObj).then(t=>{t.code===200&&(this.myApi.success("\u4FDD\u5B58\u6210\u529F"),this.undo())})}else this.myApi.post(this.serverUrl,e).then(t=>{t.code===200&&(this.myApi.success("\u4FDD\u5B58\u6210\u529F"),this.undo())})}query(){this.myApi.navigate(this.path)}edit(){this.disabled=!1,this.btns.forEach(e=>{e.disable=e.code==="add"||e.code==="edit"})}delete(){this.id&&this.myApi.delete(`${this.serverUrl}?id=${this.id}`).then(e=>{e.code===200&&(this.myApi.success("\u5220\u9664\u6210\u529F"),this.id="",this.restForm(),this.undo())})}restForm(){this.formCols.forEach(e=>{e.value=e.defaultValue})}};function I(s,e){s&1&&(l(0,"div",2),p(1,"nz-spin",3),h())}var G=(()=>{class s extends d{constructor(t,i){super(t,i),this.myApi=t,this.route=i}static{this.\u0275fac=function(i){return new(i||s)(r(A),r(C))}}static{this.\u0275cmp=c({type:s,selectors:[["app-set-form"]],standalone:!0,features:[f,y],decls:3,vars:4,consts:[[3,"clc","btns"],[3,"form-cols","disabled"],[1,"container"],["nzSimple","","nzSize","large",2,"margin-top","20%"]],template:function(i,o){i&1&&(l(0,"app-btns",0),v("clc",function(z){return o.btnClick(z)}),h(),p(1,"app-forms",1),u(2,I,2,0,"div",2)),i&2&&(m("btns",o.btns),a(),m("form-cols",o.formCols)("disabled",o.disabled),a(),b(o.isInit?-1:2))},dependencies:[E,_,g,F],styles:[".container[_ngcontent-%COMP%]{position:absolute;top:0;left:0;z-index:999;text-align:center;background:#0003;width:100%;height:100%}"]})}}return s})();export{G as SetFormComponent};
