import{h as s}from"./chunk-7MXG77XU.js";var o=class{constructor(e){this.isInit=!1,this.isSelected=!1,this.disabled=!1,this.formId="",this.menuCode="",this.menuName="",this.formCols=[],this.formGrids=[],this.formSingleCols=[],this.btns=[],this.serverUrl="",this.path="",this.name="",this.myApi=e}parse(){return s(this,null,function*(){yield this.beforeInitialization(),yield this.myApi.get("form/info",{formId:this.formId}).then(e=>{e.code===200&&(this.serverUrl=e.data.serverUrl,this.path=e.data.path,this.name=e.data.name,this.isSelected=e.data.isSelected)}),yield this.myApi.get("form/cols",{formId:this.formId}).then(e=>{e.code===200&&(this.formCols=e.data,this.formCols.forEach(t=>s(this,null,function*(){if(t.defaultValue=this.getDefaultValue(t.defaultValue),t.defaultValue&&(t.type==="date"?t.defaultValue=this.myApi.dateParse(t.defaultValue):t.type==="datetime"?t.defaultValue=this.myApi.datetimeParse(t.defaultValue):t.type==="time"&&(t.defaultValue=this.myApi.timeParse(t.defaultValue)),t.value=t.defaultValue),t.optionModel){let a=JSON.parse(t.optionModel);a.type==="static"?t.options=a.dataSource:a.type==="dict"?this.myApi.getDict(a.code).subscribe(i=>{t.options=i}):a.type==="api"&&this.myApi.request(a.method??"get",a.url??"",a.params).then(i=>{t.options=i.data})}})))}),yield this.myApi.get("form/grids",{formId:this.formId}).then(e=>{e.code===200&&(this.formGrids=e.data,this.formGrids.forEach(t=>s(this,null,function*(){if(t.defaultValue=this.getDefaultValue(t.defaultValue),t.optionModel){let a=JSON.parse(t.optionModel);a.type==="static"?t.options=a.dataSource:a.type==="dict"?this.myApi.getDict(a.code).subscribe(i=>{t.options=i}):a.type==="api"&&this.myApi.request(a.method??"get",a.url??"",a.params).then(i=>{t.options=i.data})}})))}),yield this.myApi.get("form/single",{formId:this.formId}).then(e=>{e.code===200&&(this.formSingleCols=e.data,this.formSingleCols.forEach(t=>s(this,null,function*(){if(t.defaultValue=this.getDefaultValue(t.defaultValue),t.optionModel){let a=JSON.parse(t.optionModel);a.type==="static"?t.options=a.dataSource:a.type==="dict"?this.myApi.getDict(a.code).subscribe(i=>{t.options=i}):a.type==="api"&&this.myApi.request(a.method??"get",a.url??"",a.params).then(i=>{t.options=i.data})}})))}),this.isInit=!0,this.afterInitialization()})}getBtns(){return s(this,null,function*(){yield this.myApi.get("form/btns",{formId:this.menuCode}).then(e=>{e.code===200&&(this.btns=e.data,this.btns=[...new Set(this.btns)])})})}afterInitialization(){}beforeInitialization(){return s(this,null,function*(){})}getDefaultValue(e){return e===null?null:e==="_UserId"?this.myApi.userService.userId:e==="_UserName"?this.myApi.userService.nickName:e==="_DateNow"?this.myApi.dateFormat(new Date):e==="_DateTimeNow"?this.myApi.datetimeFormat(new Date):e}getFormColsData(){let e={};return this.formCols.forEach(t=>{t.code.startsWith("_")||(t.type==="date"?e[t.code]=this.myApi.dateFormat(t.value):t.type==="datetime"?e[t.code]=this.myApi.datetimeFormat(t.value):t.type==="time"?e[t.code]=this.myApi.timeFormat(t.value):e[t.code]=t.value)}),e}};export{o as a};
